{# templates/coffre/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Coffre n°{{ coffre.id }}{% endblock %}

{% block body %}
    <h1 class="mb-4">Coffre n°{{ coffre.id }}</h1>

    {# Carte récap du coffre #}
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Informations du coffre</h5>
            <table class="table mb-0">
                <tbody>
                <tr>
                    <th scope="row" style="width: 20%;">Id</th>
                    <td>{{ coffre.id }}</td>
                </tr>
                <tr>
                    <th scope="row">Description</th>
                    <td>{{ coffre.description }}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <h2 class="mt-4 mb-3">Montres de ce coffre</h2>

    {% if coffre.montres is empty %}
        <p>Aucune montre dans ce coffre.</p>
    {% else %}
        <div class="row g-3 mb-4">
            {% for m in coffre.montres %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card h-100">

                        {# Image ou placeholder si aucune image #}
                        {% if m.imageFilename %}
                            <img
                                src="{{ asset('uploads/montres/' ~ m.imageFilename) }}"
                                class="card-img-top"
                                alt="Photo de {{ m.marque }} {{ m.reference }}"
                                style="object-fit: cover; max-height: 180px;"
                            >
                        {% else %}
                            <div class="d-flex align-items-center justify-content-center bg-light border-bottom"
                                 style="height: 180px;">
                                <span class="text-muted small">Aucune image disponible</span>
                            </div>
                        {% endif %}

                        <div class="card-body d-flex flex-column">
                            <h6 class="card-subtitle mb-1 text-muted">
                                #{{ m.id }}
                            </h6>
                            <h5 class="card-title mb-2">
                                {{ m.marque }} {{ m.reference }}
                            </h5>

                            {% if m.description %}
                                <p class="card-text small text-muted mb-2">
                                    {{ m.description }}
                                </p>
                            {% endif %}

                            {% if m.annee %}
                                <p class="card-text small mb-3">
                                    Année : {{ m.annee }}
                                </p>
                            {% endif %}

                            <div class="mt-auto">
                                <a class="btn btn-sm btn-outline-primary w-100"
                                   href="{{ path('app_montre_show', {'id': m.id}) }}">
                                    Gérer cette montre
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {# Bloc actions sous la liste #}
    <div class="mt-3 d-flex flex-wrap gap-2">
        <a class="btn btn-primary"
           href="{{ path('app_montre_new', { id: coffre.id }) }}">
            Ajouter une montre
        </a>

        <a class="btn btn-outline-secondary"
           href="{{ path('app_member_show', { id: coffre.member.id }) }}">
            ← Retour au membre
        </a>
    </div>
{% endblock %}
